dist: focal
before_install:
  - sudo apt-get -y install jq docker-compose
services:
  - docker
matrix:
  include:
    - install:
        - echo "$DOCKER_PASSWORD" | docker login -u alinpanaitiu --password-stdin
        - TAG=$TRAVIS_COMMIT docker-compose build
        - test "$TRAVIS_BRANCH" = "master" -o "$TRAVIS_BRANCH" = "main" && docker tag alinpanaitiu/mattermost:$TRAVIS_COMMIT alinpanaitiu/mattermost:latest && docker tag alinpanaitiu/mattermost-db:$TRAVIS_COMMIT alinpanaitiu/mattermost-db:latest || true
      script:
        - docker images
deploy:
  provider: script
  script: bash deploy.sh
  on:
    repo: alin23/mattermost-docker
    all_branches: true
env:
  global:
    - IMAGE=alinpanaitiu/mattermost
    - STACK=mattermost
    - UPDATE_COMMAND="docker-compose pull; docker-compose -p mattermost --env-file stack.env up -d"
    - RESTART=false
    - ASYNC=false
    - secure: ZdMvPShW7VfLY8PrYVLytsohH9WXftuD13eevVyF7+i1uB2qNN40IBCMJZ69DjETyDPUSvLOdn6GFIjmMurraSN5JjstzZqmf3Mvh/pm7ui+aUS3BPHxDw1+PFd4aGkTiB1f7ybGDf1sJp7Yu4Nw7IFxvc35i3+s7qPjGG6Bu01vrQBLLiYWCdgaKrrw8OTbENG5XRC01szL5wnnzox6G+jwpvoGSjCWZ8eDF6DqGJvfrwt+k31X92XtNooF8tTmdi6m+6IavTBkePoL6w6ReA54Uj8ggVD3jPrTEa6ykaj3DqQxma+sBdQ5L6+XuB4txCDLDUA23hDo30vmkU7WMmXAzi3R31nK975vHWHmCNly6m8XEDPDm022lZiSz2NIfWB9uiTGDp/HjheNnYY7mv88Qqwc8vA2MIN7NgNN9Ge7oiTICPAydSwjQ8LHEPs+xvMqePJGWOPpTnJw7VsRbcDoyCSuM/z79DWeqIGpmg7jGUVumrN53K64RswjyIaumL+IYyLlnKSGsLc9OJBAccY6O3wEQ9husiUokK5Xl2yPqM/HC70hFxeRgR7hfHB2aiUIbXejJt6oyUalbPoKLCnfK3CXtLuKLG+hyuq/QJ1Q3VOvMz7uSMz4w0FVKUBsqJdmKz7fjxuRXqtOHZ5bjLsj4he3PNwva39UP4FZrgs=
